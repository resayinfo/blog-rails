<div class="articles">
  <h1 class="page-header" align="center">"<%= @article.title %>"<br>By: <%= @article.author %></h1>
  <h2 class="articles-show-updated-sub-header">Created <%= @article.created_at.strftime('%b %-d, %Y, %l:%M %p, %Z') %><br>Updated <%= @article.updated_at.strftime('%b %-d, %Y, %l:%M %p, %Z') if @article.updated_at.present? %></h2>

    <div class="articles-show-lefty">
      <%= raw(@article.text) %>
    </div>

  <table>
    <tr>
      <% if current_user.has_role? :superadmin or current_user.has_role? :god %>
        <td><%= link_to 'Edit', edit_article_path(@article), class: 'btn btn-default' %></td>
        <td><%= link_to 'Delete', article_path(@article) , class: 'btn btn-danger',
                                method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
    </tr>
  </table>

  <h2 class="comments">Comments</h2>
  <%= render @article.comments %>
  <% if can? :manage, Comment %>
    <h3 class="comment">Add a comment:</h3>
    <%= render "comments/form" %>
  <% end %>

</div><!--. articles -->

<div class="morph-button morph-button-sidebar morph-button-fixed">
  <button type="button"><span class="icon icon-cog">Settings Menu</span></button>
  <div class="morph-content">
    <div>
      <div class="content-style-sidebar">
        <span class="icon icon-close">Close the overlay</span>
        <h2>Settings</h2>
        <ul>
          <li><a class="icon icon-camera" href="#">Default filters</a></li>
          <li><a class="icon icon-server" href="#">Storage Use</a></li>
          <li><a class="icon icon-heart" href="#">Favorites</a></li>
          <li><a class="icon icon-zoom-in" href="#">Readability</a></li>
          <li><a class="icon icon-microphone" href="#">Speech</a></li>
          <li><a class="icon icon-cloud" href="#">Uploads</a></li>
          <li><a class="icon icon-user" href="#">Profile</a></li>
          <li><a class="icon icon-briefcase" href="#">Documents</a></li>
          <li><a class="icon icon-globe" href="#">Global Options</a></li>
        </ul>
      </div>
    </div>
  </div>
</div><!-- morph-button -->
<script>
  (function() {
    var docElem = window.document.documentElement, didScroll, scrollPosition;

    // trick to prevent scrolling when opening/closing button
    function noScrollFn() {
      window.scrollTo( scrollPosition ? scrollPosition.x : 0, scrollPosition ? scrollPosition.y : 0 );
    }

    function noScroll() {
      window.removeEventListener( 'scroll', scrollHandler );
      window.addEventListener( 'scroll', noScrollFn );
    }

    function scrollFn() {
      window.addEventListener( 'scroll', scrollHandler );
    }

    function canScroll() {
      window.removeEventListener( 'scroll', noScrollFn );
      scrollFn();
    }

    function scrollHandler() {
      if( !didScroll ) {
        didScroll = true;
        setTimeout( function() { scrollPage(); }, 60 );
      }
    };

    function scrollPage() {
      scrollPosition = { x : window.pageXOffset || docElem.scrollLeft, y : window.pageYOffset || docElem.scrollTop };
      didScroll = false;
    };

    scrollFn();

    var el = document.querySelector( '.morph-button' );

    new UIMorphingButton( el, {
      closeEl : '.icon-close',
      onBeforeOpen : function() {
        // don't allow to scroll
        noScroll();
      },
      onAfterOpen : function() {
        // can scroll again
        canScroll();
        // add class "noscroll" to body
        classie.addClass( document.body, 'noscroll' );
        // add scroll class to main el
        classie.addClass( el, 'scroll' );
      },
      onBeforeClose : function() {
        // remove class "noscroll" to body
        classie.removeClass( document.body, 'noscroll' );
        // remove scroll class from main el
        classie.removeClass( el, 'scroll' );
        // don't allow to scroll
        noScroll();
      },
      onAfterClose : function() {
        // can scroll again
        canScroll();
      }
    } );
  })();
</script>
